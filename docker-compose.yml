version: "3.9"

services:
  pg-snippets: #levanta postgres16
    image: postgres:16
    environment:
      POSTGRES_USER: snippets
      POSTGRES_PASSWORD: snippets
      POSTGRES_DB: snippets
    volumes: ["pg_snippets:/var/lib/postgresql/data"]
    ports: ["5433:5432"]
    networks: [printscript-net]

  snippets:
    build: . #usa el Dockerfile de la ra√≠z para construir la imagen.
    container_name: ps-snippets
    ports: [ "8081:8081" ]
    environment:
      # Datasource dentro de Docker (no localhost)
      SPRING_DATASOURCE_URL: jdbc:postgresql://pg-snippets:5432/snippets #nombre del servicio de Postgres dentro de la red
      SPRING_DATASOURCE_USERNAME: snippets
      SPRING_DATASOURCE_PASSWORD: snippets
      # URL a Execution en la MISMA red de Docker
      EXECUTION_BASE_URL: http://execution:8082
      LOGGING_LEVEL_ROOT: INFO
      SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI: https://dev-c2gyaqqsxa2v3nig.us.auth0.com/
      AUTH0_AUDIENCE: https://snippet-manager
      NEW_RELIC_APP_NAME: "printscript-authorization"
      NEW_RELIC_AGENT_ENABLED: false
    depends_on: [ pg-snippets ]
    networks: [ printscript-net ]

volumes:
  pg_snippets: {}

networks:
  printscript-net:
    external: true

